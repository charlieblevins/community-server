{"version":3,"file":"PostOperationHandler.js","sourceRoot":"","sources":["../../../src/http/ldp/PostOperationHandler.ts"],"names":[],"mappings":";;;AAAA,mDAAqD;AAErD,+EAA4E;AAC5E,uFAAoF;AACpF,8FAA2F;AAG3F,yDAAsD;AAEtD;;;GAGG;AACH,MAAa,oBAAqB,SAAQ,mCAAgB;IAKxD,YAAmB,KAAoB;QACrC,KAAK,EAAE,CAAC;QALS,WAAM,GAAG,sBAAY,CAAC,IAAI,CAAC,CAAC;QAM7C,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;IACrB,CAAC;IAEM,KAAK,CAAC,SAAS,CAAC,EAAE,SAAS,EAAyB;QACzD,IAAI,SAAS,CAAC,MAAM,KAAK,MAAM,EAAE;YAC/B,MAAM,IAAI,iDAAuB,CAAC,4CAA4C,CAAC,CAAC;SACjF;IACH,CAAC;IAEM,KAAK,CAAC,MAAM,CAAC,EAAE,SAAS,EAAyB;QACtD,wEAAwE;QACxE,8DAA8D;QAC9D,6DAA6D;QAC7D,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE;YACxC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,yDAAyD,CAAC,CAAC;YAC5E,MAAM,IAAI,yCAAmB,CAAC,yDAAyD,CAAC,CAAC;SAC1F;QACD,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,SAAS,CAAC,MAAM,EAAE,SAAS,CAAC,IAAI,EAAE,SAAS,CAAC,UAAU,CAAC,CAAC;QACtG,OAAO,IAAI,uDAA0B,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;IAC3D,CAAC;CACF;AA3BD,oDA2BC","sourcesContent":["import { getLoggerFor } from '../../logging/LogUtil';\nimport type { ResourceStore } from '../../storage/ResourceStore';\nimport { BadRequestHttpError } from '../../util/errors/BadRequestHttpError';\nimport { NotImplementedHttpError } from '../../util/errors/NotImplementedHttpError';\nimport { CreatedResponseDescription } from '../output/response/CreatedResponseDescription';\nimport type { ResponseDescription } from '../output/response/ResponseDescription';\nimport type { OperationHandlerInput } from './OperationHandler';\nimport { OperationHandler } from './OperationHandler';\n\n/**\n * Handles POST {@link Operation}s.\n * Calls the addResource function from a {@link ResourceStore}.\n */\nexport class PostOperationHandler extends OperationHandler {\n  protected readonly logger = getLoggerFor(this);\n\n  private readonly store: ResourceStore;\n\n  public constructor(store: ResourceStore) {\n    super();\n    this.store = store;\n  }\n\n  public async canHandle({ operation }: OperationHandlerInput): Promise<void> {\n    if (operation.method !== 'POST') {\n      throw new NotImplementedHttpError('This handler only supports POST operations');\n    }\n  }\n\n  public async handle({ operation }: OperationHandlerInput): Promise<ResponseDescription> {\n    // Solid, ยง2.1: \"A Solid server MUST reject PUT, POST and PATCH requests\n    // without the Content-Type header with a status code of 400.\"\n    // https://solid.github.io/specification/protocol#http-server\n    if (!operation.body.metadata.contentType) {\n      this.logger.warn('POST requests require the Content-Type header to be set');\n      throw new BadRequestHttpError('POST requests require the Content-Type header to be set');\n    }\n    const modified = await this.store.addResource(operation.target, operation.body, operation.conditions);\n    return new CreatedResponseDescription(modified.resource);\n  }\n}\n"]}