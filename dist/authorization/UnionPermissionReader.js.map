{"version":3,"file":"UnionPermissionReader.js","sourceRoot":"","sources":["../../src/authorization/UnionPermissionReader.ts"],"names":[],"mappings":";;;AACA,gEAA6D;AAI7D;;;GAGG;AACH,MAAa,qBAAsB,SAAQ,2BAA8B;IACvE,YAAmB,OAA2B;QAC5C,KAAK,CAAC,OAAO,CAAC,CAAC;IACjB,CAAC;IAES,KAAK,CAAC,OAAO,CAAC,OAAwB;QAC9C,MAAM,MAAM,GAAkB,EAAE,CAAC;QACjC,KAAK,MAAM,aAAa,IAAI,OAAO,EAAE;YACnC,KAAK,MAAM,CAAE,GAAG,EAAE,KAAK,CAAE,IAAI,MAAM,CAAC,OAAO,CAAC,aAAa,CAAkD,EAAE;gBAC3G,MAAM,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,gBAAgB,CAAC,KAAK,EAAE,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC;aACzD;SACF;QACD,OAAO,MAAM,CAAC;IAChB,CAAC;IAED;;OAEG;IACK,gBAAgB,CAAC,WAAwB,EAAE,SAAqB,EAAE;QACxE,IAAI,CAAC,WAAW,EAAE;YAChB,OAAO,MAAM,CAAC;SACf;QAED,KAAK,MAAM,CAAE,GAAG,EAAE,KAAK,CAAE,IAAI,MAAM,CAAC,OAAO,CAAC,WAAW,CAAgD,EAAE;YACvG,IAAI,OAAO,KAAK,KAAK,WAAW,IAAI,MAAM,CAAC,GAAG,CAAC,KAAK,KAAK,EAAE;gBACzD,MAAM,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC;aACrB;SACF;QACD,OAAO,MAAM,CAAC;IAChB,CAAC;CACF;AA9BD,sDA8BC","sourcesContent":["import type { CredentialGroup } from '../authentication/Credentials';\nimport { UnionHandler } from '../util/handlers/UnionHandler';\nimport type { PermissionReader } from './PermissionReader';\nimport type { Permission, PermissionSet } from './permissions/Permissions';\n\n/**\n * Combines the results of multiple PermissionReaders.\n * Every permission in every credential type is handled according to the rule `false` \\> `true` \\> `undefined`.\n */\nexport class UnionPermissionReader extends UnionHandler<PermissionReader> {\n  public constructor(readers: PermissionReader[]) {\n    super(readers);\n  }\n\n  protected async combine(results: PermissionSet[]): Promise<PermissionSet> {\n    const result: PermissionSet = {};\n    for (const permissionSet of results) {\n      for (const [ key, value ] of Object.entries(permissionSet) as [ CredentialGroup, Permission | undefined ][]) {\n        result[key] = this.applyPermissions(value, result[key]);\n      }\n    }\n    return result;\n  }\n\n  /**\n   * Adds the given permissions to the result object according to the combination rules of the class.\n   */\n  private applyPermissions(permissions?: Permission, result: Permission = {}): Permission {\n    if (!permissions) {\n      return result;\n    }\n\n    for (const [ key, value ] of Object.entries(permissions) as [ keyof Permission, boolean | undefined ][]) {\n      if (typeof value !== 'undefined' && result[key] !== false) {\n        result[key] = value;\n      }\n    }\n    return result;\n  }\n}\n"]}